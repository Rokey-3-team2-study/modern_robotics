# Moder Robotics

## Chapter 12. Grasping and Manipulation, 파지와 조작

- 선형 생성의 정의
    - 어떤 벡터들의 집합 $\{v_1, v_2, \dots, v_k\}$이 주어졌을 때, 이 벡터들의 **모든 선형 결합**으로 만들어지는 공간입니다:
$$
\text{span}\{v_1, v_2, \dots, v_k\} = \left\{ \sum_{i=1}^k \alpha_i v_i \mid \alpha_i \in \mathbb{R} \right\}
$$

- **양의 생성** (Positive Span)
    - 계수 $\alpha_i$는 **0 이상 (non-negative)**.
    - 즉, 벡터들의 **모든 비음수 선형 결합**만 포함됨.
    - 이건 한쪽 방향으로만 뻗어나가는 **원뿔(cone)** 을 형성해.
    - **마찰원추(friction cone)** 도 이 개념과 연결돼.
    - Force Closure 판별 시, **원점을 이 양의 생성이 포함하는가**?를 보는 것이 핵심이야.
$$
\text{pos}\{v_1, ..., v_k\} = \left\{ \sum_{i=1}^k \alpha_i v_i \mid \alpha_i \ge 0 \right\}
$$

- **볼록 생성** (Convex Hull)
    - 계수는 **0 이상**, 그리고 **합이 1**이어야 함.
    - 이는 벡터들을 "중간 어딘가에서 섞은 것"을 의미해.
    - 볼록 생성은 벡터들 사이를 잇는 **볼록 다각형(또는 다면체)** 을 이룸.
    - 예: 두 점이면 선분, 세 점이면 삼각형, 등등
$$
\text{conv}\{v_1, ..., v_k\} = \left\{ \sum_{i=1}^k \alpha_i v_i \mid \alpha_i \ge 0, \sum_{i=1}^k \alpha_i = 1 \right\}
$$

- 로봇 파지에서의 활용
    - 로봇이 물체를 파지할 때, 각 **접촉점에서의 가능한 렌치들**을 수집해 이들의 선형 생성 공간을 구합니다. 이 선형 생성 공간이 특정 조건을 만족하면 **힘 구속(force closure)** 또는 **형태 구속(form closure)** 를 충족합니다.
    - **Form closure**:
        - 물체가 외력 없이도 고정되기 위한 조건.
        - 모든 6 자유도 방향에 대해 운동이 막히도록, 렌치들의 선형 생성 공간이 $\mathbb{R}^6$ 전체를 덮어야 함.    
    - **Force closure**:
        - 외부 힘에 대해 균형을 이룰 수 있는 접촉력 조합이 존재하는 경우.
        - 마찰을 고려한 접촉 렌치들의 **양의 선형 생성(positive span)** 을 통해 판별 가능.
- 예시
    - 접촉점이 3개 있고, 각 접촉점에서 발생할 수 있는 렌치를 $\mathbf{w}_1, \mathbf{w}_2, \mathbf{w}_3 \in \mathbb{R}^6$ 라고 하자.  
    - 이들의 선형 생성이 $\mathbb{R}^6$을 덮는다면, 어떠한 외부 렌치도 내부 접촉 렌치 조합으로 상쇄할 수 있음을 의미하며, **힘 구속 조건을 만족**합니다.

- 핵심 정리
    - **선형 생성**은 로봇이 **접촉점을 통해 얼마나 다양한 힘과 모멘트를 생성할 수 있는지**를 결정.
    - 파지 안정성 검증, 제어 가능성 판단 등에 사용됨.
    - 수학적으로는 **기저 벡터(span vectors)** 들의 **랭크(rank)** 를 계산하거나 **내포 여부(subspace inclusion)** 를 확인함으로써 분석됨.


### 12.1 Contact Kinematics, 접촉 기구학

- 거리 함수의 시간 변화율
    - $d(q)$: 물체 A와 B 사이의 접촉점 거리 함수 (일반적으로 두 점 사이의 거리)
    - $q$: 전체 시스템의 일반화 좌표 (joint angles 등)
    - 이 수식은 접촉점 간 거리의 **변화율**, 즉 두 물체가 가까워지고 있는지 멀어지고 있는지를 나타냄.
    - 접촉이 유지되려면 $\dot{d} = 0$ 이어야 한다.
$$
\dot{d} = \frac{\partial d}{\partial q} \dot{q}
$$

- 거리 함수의 2차 미분
    - 거리 함수의 **가속도** 표현.
    - 접촉 유지 조건이 동역학적으로 고려될 때 필요.
    - 제어기 설계에서 "접촉 가속도를 0으로 유지"할 때 사용될 수 있음.
$$
\ddot{d} = \dot{q}^T \frac{\partial^2 d}{\partial q^2} \dot{q} + \frac{\partial d}{\partial q} \ddot{q}
$$

- 비침투 조건 (Impenetrability Condition)
    - $\hat{n}$: 접촉면의 법선 벡터.
    - $\dot{p}_A, \dot{p}_B$: 물체 A, B의 접촉점 속도.
    - 의미: 두 물체가 **서로 멀어지거나 정지**는 가능하지만, **서로 침투하는 방향으로는 움직일 수 없다**는 조건.
$$
\hat{n}^T (\dot{p}_A - \dot{p}_B) \geq 0
$$

- 트위스트 기반의 비침투 조건
    - $V_A, V_B$: 물체 A, B의 트위스트 (angular + linear velocity)
    - $[p_A]$: 위치벡터 $p_A$의 벡터곱 행렬 (skew-symmetric)
    - $F$: 단위 렌치 벡터, 접촉점에 수직으로 작용하는 힘의 방향을 나타냄
    - 의미: 트위스트 차이를 렌치 방향으로 투영했을 때 **접촉 침투 방향의 속도가 0 이상**여야 한다.
$$
F^T (V_A - V_B) \geq 0,\quad \text{where } F = ([p_A] \hat{n},\ \hat{n})
$$

- 활성 제약 조건
    - 비침투 조건 중에서도 접촉이 **유지되고 있을 때**는 속도 차이가 **정확히 0**이어야 함.
    - 즉, 접촉면 법선 방향으로 상대 속도가 전혀 없어야 함 → 접촉 유지 상태
$$
F^T (V_A - V_B) = 0
$$

- 순수 굴림 제약
    - 접촉점의 절대 속도가 양 물체에서 동일하다는 것을 의미
    - **Pure rolling** 상황에서는 접촉점이 미끄러지지 않음 → 양측 속도 일치
    - 일반적으로 슬립이 없는 rolling 상황에서 적용
$$
v_A + [\omega_A] p_A = v_B + [\omega_B] p_B
$$

- 다중 접촉 일반 조건
    - 이 식은 **물체 A가 다른 물체들과 접촉하고 있는 상황**에서,  **“물체 A가 어떤 twist $V_A$로 운동할 수 있는가?”** 를 결정하는 조건
    - 이 식은 물체 A가 각 접촉점에서 **침투하지 않도록 움직일 수 있는 twist** $V_A$들의 집합을 정의합니다.
    - $V$는 가능한 운동의 공간이며, 이는 **부등식 제약을 만족하는 속도 원뿔**(velocity cone)입니다.
$$
V = \{V_A|F^T_i (V_A - V_i) \geq 0 \; \forall{i}\}
$$

- 형태 구속 (Form Closure) 조건
    - $F \in \mathbb{R}^{6 \times j}$: $j$개의 접촉 렌치를 열벡터로 가지는 행렬
    - 의미: 각 접촉점에 $k_i \geq 1$의 양의 힘을 줄 수 있으면서, 그 합이 순수한 외력에 저항할 수 있음
        - 아무리 힘을 가해도 물체는 **움직이지 않음**
        - **모든 자유도**(6 DOF)가 제약되어 있음
        - **마찰이 없어도** 성립함 (순수한 기하학적 고정)
    - 존재한다면: 모든 외부 렌치를 막을 수 있음 → **형태 구속을 만족**
        - 접촉점에서 생성 가능한 모든 렌치를 $F_1, F_2, ..., F_j$라고 할 때:
        - $F$: 접촉 렌치를 열벡터로 모은 $6 \times j$ 행렬
        - $k$: 각 접촉점에서의 **규정된 힘의 크기** (음수 불가)
        - 즉, 접촉력들이 서로를 상쇄해서 **합력이 0이 되면서도** 각 접촉에는 양의 힘이 존재 → **어떤 외력도 상쇄 가능**
$$
\text{Find } k \in \mathbb{R}^j \text{ such that } Fk = 0,\quad k_i \geq 1
$$

---
### 12.2 Contact Forces and Friction, 접촉힘과 마찰

- 쿨롱 마찰 모델 (Coulomb Friction Model)
    - 접촉점에서 작용하는 힘은 **법선력**과 **마찰력**으로 구성됨.
    - **마찰력의 크기**는 다음 조건을 만족:
    $$
    \|f_t\| \leq \mu f_n
    $$
    - $f_t$ : 접선 방향의 마찰력
    - $f_n$ : 법선 방향의 접촉력 (항상 $f_n \geq 0$)
    - $\mu$ : 정지 마찰계수
    - 이 조건은 **마찰원추**(Friction Cone)를 정의함.

- 마찰원추 (Friction Cone)
    - 가능한 접촉력의 방향을 3D 공간에서 표현한 **원추형 공간**.
    - 원추 내부의 힘은 **정지 상태**를 유지 가능.
    - 원추 표면 위의 힘은 **슬라이딩 상태**, 방향은 마찰력의 방향.
    - **선형 근사**: 실제 원추는 곡면이지만, 다면체로 근사해서 계산 효율 향상.

---
### 12.3 Manipulatuion, 조작

- 조작이란? 

- 단순히 물체를 "잡고 있는 것(grasping)"을 넘어서 **움직이거나 조작하는 것 전체**를 의미함.
- 대표적인 조작 방식:
  - **슬라이딩 (sliding)**
  - **굴림 (rolling)**
  - **던지기 (throwing)**
  - **진동 기반 이동 (vibration-driven motion)**
  - **손에서 손으로 물체 전달 (hand-off)** 등

- 조작을 위한 동역학 모델

  - 물체의 운동을 고려해야 하므로, **뉴턴-오일러 역학**을 사용:
  
  $$
  \sum k_i F_i + F_{\text{ext}} = G\dot{V} - [\text{ad}_\mathcal{V}]^T G V
  $$

  - $F_i$: 접촉점에서의 힘/모멘트 (렌치)
  - $F_{\text{ext}}$: 외부에서 가해지는 힘 (예: 중력)
  - $G$: 물체의 관성 행렬
  - $V$: 물체의 바디 트위스트 (선형+회전 속도)
  - $[\text{ad}_V]^T$: 트위스트의 고급 항 (비선형 관성항 반영)

- 접촉력의 표현

  - 각 접촉점의 **렌치 $F_i$** 는 다음과 같이 표현됨:

  $$
  F_i = W_i f_i
  $$

  - $f_i$: 접촉점에서의 힘 벡터
  - $W_i$: $f_i$를 물체 프레임 기준의 렌치로 변환하는 행렬

- 구속 조건 (Constraints)
  - 접촉점은 마찰에 따라 **마찰원추 안에서의 힘**만 허용됨.
  - 물체의 운동은 접촉점의 상대 속도와 **운동학적 제약**을 만족해야 함.

---
### Summary

- **접촉 운동학 (Contact Kinematics)**
    - 각 접촉점에서 물체의 트위스트 $V$와 접촉점 상대 속도 $V_i$는 다음 관계를 갖는다:

    $$
    V_i = J_{s_i} V
    $$

    - $J_{s_i}$: $i$번째 접촉점에서의 공간 자코비안  
    - 이 행렬을 통해 접촉점의 움직임 제약을 표현할 수 있음.

- **형태 구속 (Form Closure)**
    - 물체가 외부 힘 없이도 완전히 고정되는 조건.
    - 수학적으로는 가능한 운동 트위스트 $V$가 **오직 0만 가능**해야 함:

    $$
    J_s V = 0 \quad \Rightarrow \quad V = 0 \text{만이 유일한 해}
    $$

    - $J_s$: 전체 접촉점에 대한 자코비안 행렬  
    - 즉, 모든 운동 자유도를 제거하는 완전 구속 상태.

- **힘 구속 (Force Closure)**
    - 외부 힘 $F_{\text{ext}}$에 대항할 수 있는 접촉력 조합이 존재할 때:

    $$
    \exists \{f_i\} \text{ such that } \sum_i J_{s_i}^T f_i = -F_{\text{ext}}
    $$

    - $f_i$: $i$번째 접촉점에서의 접촉력  
    - $J_{s_i}^T f_i$: 물체에 미치는 해당 접촉점의 렌치  
    - 즉, 마찰이 충분하고 접촉점이 적절하면 외력을 상쇄 가능.

- **마찰 원추 (Friction Cone)**
    - 마찰이 있는 접촉점에서 힘은 **다음 조건을 만족해야** 유효함:

        $$
        \|f_t\| \leq \mu f_n
        $$

        - $f_t$: 접촉면에서의 접선력 (슬라이딩을 막음)  
        - $f_n$: 접촉면 수직 방향의 힘  
        - $\mu$: 마찰계수  
        - 이를 만족하는 힘 벡터의 집합이 "마찰 원추(friction cone)"

    - 쿨롱 마찰 모델, **마찰원추(friction cone)** 내의 힘만 허용:  
        $$
        \sqrt{f_{t}^2 + f_{o}^2} \leq \mu f_{n}
        $$
        - $f_{t}, f_{o}$ : 접촉면에서의 힘(접선방향)
        - $f_{n}$ : 접촉면에 수직인 힘(정압)
        - $\mu$: 마찰계수

- **조작 동역학 (Manipulation Dynamics)**
    - 외력과 접촉력이 작용할 때 물체의 운동을 설명하는 방정식:

    $$
    F_{\text{ext}} + \sum_{i} k_i F_{i} = G\dot{V} - [\text{ad}_V]^T GV
    $$

    - $F_{\text{ext}}$: 외부 렌치
    - $F_{i}$: 각 접촉점에서의 렌치
    - $G$: 관성행렬
    - $V$: twist
    - $[\text{ad}_V]^T$: twist의 보조행렬(adjoint 연산)

- **운동/힘 자유도의 이중성 (Duality of Motion and Force)**
    - 물체가 **운동 가능한 방향**과 **힘을 적용 가능한 방향**은 서로 보완됨:

    $$
    \text{null}(J_s) \leftrightarrow \text{row space}(J_s^T)
    $$

    - $\text{null}(J_s)$: 가능한 twist 방향들  
    - $\text{row space}(J_s^T)$: 가능한 렌치 공간  
    - 이중성 개념은 파지 설계 및 조작 전략의 핵심 수학적 원리